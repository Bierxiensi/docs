(window.webpackJsonp=window.webpackJsonp||[]).push([[182],{606:function(t,s,a){"use strict";a.r(s);var e=a(28),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"前置知识"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前置知识"}},[t._v("#")]),t._v(" 前置知识")]),t._v(" "),a("blockquote",[a("p",[t._v("今日【middle - 9.deep_readonly】")])]),t._v(" "),a("p",[t._v("在这之前需要掌握一点Ts基础知识，可以参考学习记录"),a("RouterLink",{attrs:{to:"/Web/TypeScript/typescript1.html"}},[t._v("TypeScript学习记录-[数据类型]")]),t._v("、"),a("RouterLink",{attrs:{to:"/Web/TypeScript/typescript1.html"}},[t._v("TypeScript学习记录-[类和接口]")]),t._v("、"),a("RouterLink",{attrs:{to:"/Web/TypeScript/typescript1.html"}},[t._v("TypeScript学习记录-[枚举和泛型]")]),t._v("、"),a("RouterLink",{attrs:{to:"/Web/TypeScript/typescript1.html"}},[t._v("TypeScript学习记录-[类型别名]")])],1),t._v(" "),a("h1",{attrs:{id:"二、题目分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、题目分析"}},[t._v("#")]),t._v(" 二、题目分析")]),t._v(" "),a("h2",{attrs:{id:"deepreadonly"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deepreadonly"}},[t._v("#")]),t._v(" DeepReadonly")]),t._v(" "),a("p",[a("strong",[t._v("实现一个通用的DeepReadonly"),a("T",[t._v("，它将对象的每个参数及其子对象递归地设为只读。")])],1)]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("type DeepReadonly"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" any\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* _____________ Test Cases _____________ */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" type "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Equal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Expect "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@type-challenges/utils'")]),t._v("\n\ntype cases "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  Expect"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Equal"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("DeepReadonly"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("X")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Expected"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\ntype "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("X")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("a")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("b")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" string\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("c")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("d")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("g")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("h")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("i")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("j")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'string'")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("k")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("l")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hi'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("m")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hey'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\ntype Expected "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  readonly "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("a")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v("\n  readonly b"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" string\n  readonly c"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    readonly d"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean\n    readonly e"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      readonly g"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        readonly h"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          readonly i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n          readonly j"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'string'")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        readonly k"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      readonly l"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" readonly "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hi'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          readonly m"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" readonly "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hey'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[t._v("我们知道JS的数据类型由七种原始数据类型（ Number， Boolean， String， Symbol， Bigint， Null， Undefined）以及对象（Objects）和函数（functions）两个基本元素构成，此外还有一些特殊的诸如 "),a("code",[t._v("Date")]),t._v("、"),a("code",[t._v("RegExp")]),t._v(" 等对象元素。一个通用的 "),a("code",[t._v("DeepReadonly")]),t._v(" 需要为所有原始数据类型添加 "),a("code",[t._v("readonly")]),t._v(" 修饰符，而对于函数元素、"),a("code",[t._v("RegExp")]),t._v(" 等对象元素来说并不需要，因此必然会分情况讨论。面对嵌套的 "),a("code",[t._v("Object")]),t._v(" 也必然会使用递归。")]),t._v(" "),a("li",[t._v("普通的 "),a("code",[t._v("Readonly")]),t._v(" 仅需一次循环即可为所有的属性添加 "),a("code",[t._v("readonly")]),t._v(" 修饰 ，即 "),a("code",[t._v("type DeepReadonly<T, keys extends keyof T> = { readonly [key in keys]: T[key] }")]),t._v(" ，其中 "),a("code",[t._v("keys extends keyof T")]),t._v(" 对联合类型 "),a("code",[t._v("keys")]),t._v(" 进行类型约束，确保后续使用 "),a("code",[t._v("in")]),t._v(" 遍历 "),a("code",[t._v("keys")]),t._v(" 时的每一个类型 "),a("code",[t._v("key")]),t._v(" 均在泛型 "),a("code",[t._v("T")]),t._v(" 的类型中。但目前的 "),a("code",[t._v("DeepReadonly")]),t._v(" 有两点不同，一是无法确定类型 "),a("code",[t._v("key")]),t._v(" 是否是原始类型，不能直接的在前面添加 "),a("code",[t._v("readonly")]),t._v("；二是无法确定类型 "),a("code",[t._v("key")]),t._v(" 是否嵌套包含了其他类型，因此需要递归处理。")]),t._v(" "),a("li",[t._v("针对第一点，需要逐一对类型做枚举，即 "),a("code",[t._v("type DeepReadonly<T, keys extends keyof T> = T extends Function ? T : readonly [key in keys]: T[key] }")]),t._v("这里仅以 "),a("code",[t._v("Function")]),t._v(" 元素为例，使用 "),a("code",[t._v("extends ? :")]),t._v(" 进行条件判断，如果泛型T是 "),a("code",[t._v("Function")]),t._v(" 直接返回就好，否则才进行下一步。")]),t._v(" "),a("li",[t._v("针对第二点，需要对类型 "),a("code",[t._v("key")]),t._v(" 进行递归调用，即 "),a("code",[t._v("type DeepReadonly<T, keys extends keyof T> = T extends Function ? T : readonly [key in keys]: DeepReadonly<T[key]> }")]),t._v("。")])]),t._v(" "),a("p",[t._v("一个完善的DeepReadonly可以参考"),a("a",{attrs:{href:"https://github.com/vuejs/core/blob/main/packages/reactivity/src/reactive.ts",target:"_blank",rel:"noopener noreferrer"}},[t._v("vuejs/core"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/55a6196a965949c0bb7c907f6239bf41~tplv-k3u1fbpfcp-watermark.image?",alt:"6d8d2bbce650c8298477abbaecf3292.png"}})])])}),[],!1,null,null,null);s.default=n.exports}}]);